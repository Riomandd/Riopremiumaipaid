<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIO PTN V2</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap');
        
        :root {
            --primary: #8b5cf6;
            --secondary: #0ea5e9;
            --accent: #ec4899;
            --dark: #0f172a;
            --darker: #020617;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 16px;
        }
        
        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        
        .flip-in {
            animation: flipIn 0.5s ease-out forwards;
        }
        
        @keyframes flipIn {
            from { transform: rotateX(90deg); opacity: 0; }
            to { transform: rotateX(0deg); opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pattern-display {
            font-family: monospace;
            letter-spacing: 2px;
        }
        
        .neuron {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(14, 165, 233, 0.15));
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .ai-chip {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        
        .sureshot-glow {
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.7);
            animation: sureshotPulse 2s infinite;
        }
        
        @keyframes sureshotPulse {
            0% { box-shadow: 0 0 15px rgba(74, 222, 128, 0.7); }
            50% { box-shadow: 0 0 20px rgba(74, 222, 128, 0.9); }
            100% { box-shadow: 0 0 15px rgba(74, 222, 128, 0.7); }
        }
        
        .perfect-glow {
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.7);
            animation: perfectPulse 1.5s infinite;
        }
        
        @keyframes perfectPulse {
            0% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 25px rgba(16, 185, 129, 1); }
            100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.7); }
        }
        
        .ultra-sureshot-glow {
            box-shadow: 0 0 20px rgba(236, 72, 153, 0.8);
            animation: ultraSureshotPulse 1.2s infinite;
        }
        
        @keyframes ultraSureshotPulse {
            0% { box-shadow: 0 0 20px rgba(236, 72, 153, 0.8); }
            50% { box-shadow: 0 0 30px rgba(236, 72, 153, 1); }
            100% { box-shadow: 0 0 20px rgba(236, 72, 153, 0.8); }
        }
        
        .history-container, .patterns-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .neural-pulse {
            animation: neuralPulse 3s infinite;
        }
        
        @keyframes neuralPulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        .high-confidence {
            border-left: 4px solid #3b82f6;
        }
        
        .perfect-prediction {
            border-left: 4px solid #10b981;
        }
        
        .ultra-sureshot {
            border-left: 4px solid #ec4899;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .win-icon {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .loss-icon {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .pending-icon {
            animation: rotatePulse 2s infinite;
        }
        
        @keyframes rotatePulse {
            0% { transform: rotate(0deg) scale(1); opacity: 1; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.7; }
            100% { transform: rotate(360deg) scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="relative">
    <div id="app-root" class="max-w-md mx-auto relative pb-24 min-h-screen px-4"></div>
    <div id="navigation-root"></div>
    
<!-- About Popup -->
<div id="aboutModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-60">
  <div class="bg-gray-900 text-white w-11/12 max-w-sm p-6 rounded-xl shadow-xl relative">
    <button onclick="closePopup('aboutModal')" class="absolute top-3 right-3 text-gray-400 hover:text-white">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <h2 class="text-xl font-bold mb-3">About Inferno V1</h2>
    <p class="text-sm text-gray-300 leading-relaxed">
RIO PTN V2 is a cutting-edge AI-powered prediction system designed to deliver accurate, real-time predictions using advanced algorithms and intelligent data processing. Built to adapt and evolve with changing trends, RIO PTN V2 harnesses the power of artificial intelligence to analyze past patterns, recognize hidden behaviors, and make smarter, faster predictions. Whether you're using it for gaming, number analysis, or trend forecasting, RIO PTN V2 stands out with its sleek interface, rapid processing, and consistent performance. Its fusion of neural logic, streak-loss prevention, and smart decision-making makes it a reliable companion for users seeking a powerful edge. With each cycle, the system learns, improves, and refines its prediction models—ensuring maximum accuracy with minimal risk. Designed for both beginners and pros, RIO PTN V2 combines performance, intelligence, and simplicity in one seamless platform. This isn’t just another prediction tool—it’s a revolutionary leap into the future of AI forecasting. Unleash the fire of precision.
    </p>
  </div>
</div>

<!-- Video Popup -->
<div id="videoModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-60">
  <div class="bg-gray-900 w-11/12 max-w-sm rounded-xl p-4 relative shadow-xl">
    <button onclick="closePopup('videoModal')" class="absolute top-3 right-3 text-gray-400 hover:text-white">
      <i data-lucide="x" class="w-5 h-5"></i>
    </button>
    <div class="aspect-w-16 aspect-h-9">
<iframe 
  class="w-full h-64 rounded-lg" 
  src="https://www.instagram.com/mythic_rio_?igsh=dDR0cXN0NGc4N2ti" 
  frameborder="0" 
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
  allowfullscreen>
</iframe>
      </div>
  </div>
</div>


    <script>
        // State Management
        let state = {
            activeTab: 'home',
            currentPeriod: '',
            recentResults: [],
            history: [],
            currentPrediction: null,
            currentStreak: null,
            selectedItems: [],
            currentTime: '',
            lastFetchedPeriod: null,
            showPatterns: false,
            lastLossPeriod: null,
            consecutiveLosses: 0,
            skipNext: false,
            patternStats:{},
            isLive: false,
            patternBlacklist: [],
            sureshotCooldown: 0,
            systemError: false,
            isLoading: false,
            stats: {
                totalWins: 0,
                totalLosses: 0,
                skipped: 0,
                winRate: 0,
                sureshotWins: 0,
                sureshotTotal: 0,
                ultraSureshotWins: 0,
                ultraSureshotTotal: 0,
                perfectWins: 0,
                perfectTotal: 0,
                highConfidenceWins: 0,
                highConfidenceTotal: 0,
                moderateWins: 0,
                moderateTotal: 0,
                nineTenLosses: 0,
                consecutiveSureshotWins: 0,
                consecutiveSureshotLosses: 0,
                aiPatternsGenerated: 0,
                nineDigitPatterns: 0,
                eightDigitPatterns: 0,
                tenDigitPatterns: 0,
                weightedWins: 0,
                weightedLosses: 0,
                quantumPatterns: 0,
                neuralPatterns: 0,
                humanPatterns: 0
            }
        };

        // Constants
        const MAX_HISTORY_ITEMS = 500;
        const POLLING_INTERVAL = 10000;
        const STREAK_THRESHOLD = 4;
        const LOSS_STREAK_THRESHOLD = 10;
        const RESULTS_TO_FETCH = 10;
        const MAX_CONSECUTIVE_LOSSES = 3;
        const PATTERN_LENGTH = 10;
        const SURESHOT_MIN_MATCH = 9.5;
        const ULTRA_SURESHOT_MIN_WIN_RATE = 0.95;

        // Utility Functions
        const getSize = (result) => result >= 5 ? 'B' : 'S';
        const getOpposite = (size) => size === 'B' ? 'S' : 'B';

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('predictionHistory', JSON.stringify(state.history));
            localStorage.setItem('patternStats', JSON.stringify(state.patternStats));
        }

        // AI+Human Brain Pattern Generation
        const generateBasePatterns = () => {
            const basePatterns = [
                'BBBBBBBBB', 'SSSSSSSSS', 'BBBBSSSSS', 'SSSSBBBBB',
                'BBBSSSSBB', 'SSSBBBSSS', 'BBSSBBSSB', 'SSBBSBBSS',
                'BSBSBSBSB', 'SBSBSBSBS', 'BBSBBSBBS', 'SSBSSBSSB',
                'BBSSBBSSB', 'SSBBSSBBS', 'BSSBSSBSS', 'SBBSBBSBB',
                'BBBBSSSBB', 'SSSSBBBSS', 'BBBSSSSBB', 'SSSBBBSSS',
                'BBSSSSBBS', 'SSBBBBSSB', 'BSSSSBSSB', 'SBBBBSSBS',
                'BBSSBSSBB', 'SSBBSBBSS', 'BSSBBSSBS', 'SBBSBBSBB',
                'BBSBSSBBS', 'SSBSBSSBS', 'BSBSSBSBS', 'SBSBBSBSB',
                'BBSSBBSBB', 'SSBBSBBSS', 'BSSBBSBBS', 'SBBSSBBSS',
                'BBSBBSSBB', 'SSBBSSBBS', 'BSBBSBSBS', 'SBSBSSBSB',
                'BBSSSSBBB', 'SSBBBBSSS', 'BBSBBBSSB', 'SSBSSBBSB',
                'BBBSSSBBB', 'SSSBBBSSS', 'BBSSBBSSB', 'SSBBSBBSS',
                
                // 10-digit patterns
                'BBBBBBBBBB', 'SSSSSSSSSS', 'BBBBSSSSSS', 'SSSSBBBBBB',
                'BBBSSSSBBB', 'SSSBBBSSSB', 'BBSSBBSSBB', 'SSBBSSBBSS',
                'BSBSBSBSBS', 'SBSBSBSBSB', 'BBSBBSBBSB', 'SSBSSBSSBS',
                'BBSSBBSSBB', 'SSBBSSBBSS', 'BSSBBSSBSS', 'SBBSSBBSSB',
                'BBBBSSSSBB', 'SSSSBBBBSS', 'BBBSSSSBBB', 'SSSBBBSSSB',
                'BBSSSSBBSS', 'SSBBBBSSBB', 'BSSSSBSSSB', 'SBBBBSSBBS',
                'BBBSBSBSBB', 'SSSBBSBSSS', 'BSBBBSBBBS', 'SBSSSBSSSB',
                'BBSBBBSBBB', 'SSBSSSBSSS', 'BBBBBSBBBB', 'SSSSSBSSSS',
                'BBBBSSBBBB', 'SSSSBBSSSS', 'BBBSSBBBBB', 'SSSBBSSSSS',
                'BBSSBBBBBB', 'SSBBSSSSSS', 'BSSBSSBSSB', 'SBSBSBSBSB'
            ];
            return basePatterns;
        };

        const generateHumanInspiredPatterns = () => {
            const humanPatterns = [];
            const sequences = ['BS', 'SB', 'BBSS', 'SSBB', 'BBS', 'SSB', 'BSB', 'SBS'];
            
            for (let i = 0; i < 300; i++) {
                let pattern = '';
                let lastChar = null;
                let streakCount = 0;
                const length = Math.random() < 0.2 ? 8 : Math.random() < 0.4 ? 9 : 10; // 20% 8-digit, 20% 9-digit, 60% 10-digit
                
                for (let j = 0; j < length; j++) {
                    let nextChar;
                    if (streakCount >= 2 && Math.random() < 0.7) {
                        nextChar = getOpposite(lastChar);
                    } else {
                        nextChar = sequences[Math.floor(Math.random() * sequences.length)][j % 2] || (Math.random() < 0.5 ? 'B' : 'S');
                    }
                    
                    if (j >= length - 2) {
                        const currentBs = pattern.split('').filter(c => c === 'B').length;
                        const currentSs = pattern.split('').filter(c => c === 'S').length;
                        if (Math.abs(currentBs - currentSs) > 2) {
                            nextChar = currentBs > currentSs ? 'S' : 'B';
                        }
                    }
                    
                    pattern += nextChar;
                    if (nextChar === lastChar) streakCount++;
                    else streakCount = 1;
                    lastChar = nextChar;
                }
                
                if (pattern.length === length) humanPatterns.push(pattern);
            }
            
            return humanPatterns;
        };

        const generateTransformedPatterns = (basePatterns) => {
            const transforms = [
                p => p.split('').reverse().join(''),
                p => p.substring(1) + p[0],
                p => p[p.length-1] + p.substring(0, p.length-1),
                p => p.replace(/B{3}/g, 'SBS').replace(/S{3}/g, 'BSB'),
                p => p.replace(/B{2}/g, 'SB').replace(/S{2}/g, 'BS'),
                p => p.replace(/B/g, 'X').replace(/S/g, 'B').replace(/X/g, 'S'),
                p => p.split('').map((c,i) => i%2===0 ? c : getOpposite(c)).join(''),
                p => p.split('').map((c,i) => i%3===0 ? getOpposite(c) : c).join(''),
                p => p.split('').map((c,i) => i%4===0 ? c : getOpposite(c)).join(''),
                p => p.split('').map((c,i) => i%5===0 ? getOpposite(c) : c).join(''),
                p => p.split('').map((c,i) => i%6===0 ? c : getOpposite(c)).join(''),
                p => p.split('').map((c,i) => Math.random() < 0.1 ? getOpposite(c) : c).join(''),
                p => p.substring(2) + p.slice(0,2),
                p => p.slice(-2) + p.substring(0, p.length-2),
                p => p.replace(/BSBS/g, 'SBBS').replace(/SBSB/g, 'BSSB'),
                p => p.replace(/BBSS/g, 'SSBB').replace(/SSBB/g, 'BBSS'),
                p => p.split('').map((c,i) => Math.random() < 0.15 ? getOpposite(c) : c).join('')
            ];

            let patterns = [...basePatterns];
            basePatterns.forEach(p => {
                transforms.forEach(t => {
                    const transformed = t(p);
                    if (transformed.length >= 8) patterns.push(transformed); // Ensure at least 8 digits
                });
            });
            return patterns;
        };

        const generateDynamicPatterns = () => {
            const dynamicPatterns = [];
            const basePatterns = generateBasePatterns();
            const sequences = ['BS', 'SB', 'BBSS', 'SSBB', 'BBS', 'SSB', 'BSB', 'SBS'];
            
            for (let i = 0; i < 500; i++) {
                let pattern = '';
                const length = Math.random() < 0.2 ? 8 : Math.random() < 0.4 ? 9 : 10; // 20% 8-digit, 20% 9-digit, 60% 10-digit
                for (let j = 0; j < length; j++) {
                    pattern += sequences[Math.floor(Math.random() * sequences.length)][j % 2];
                }
                if (pattern.length === length) dynamicPatterns.push(pattern);
            }
            
            if (state.history.length > 10) {
                const historicalPatterns = state.history
                    .slice(0, 50)
                    .map(item => item.pattern)
                    .filter(p => p && p.length >= 8);
                dynamicPatterns.push(...historicalPatterns);
            }
            
            return dynamicPatterns;
        };

        const generateAIHumanDeepPatterns = () => {
            const basePatterns = generateBasePatterns();
            const humanPatterns = generateHumanInspiredPatterns();
            const transformedPatterns = generateTransformedPatterns(basePatterns);
            const dynamicPatterns = generateDynamicPatterns();
            
            let allPatterns = [...new Set([...basePatterns, ...humanPatterns, ...transformedPatterns, ...dynamicPatterns])].filter(pattern => {
                if (pattern.match(/(B{4,}|S{4,})/g)) return false;
                const transitions = (pattern.match(/BS|SB/g) || []).length;
                if (transitions < 3) return false;
                const bCount = (pattern.match(/B/g) || []).length;
                const sCount = (pattern.match(/S/g) || []).length;
                return Math.abs(bCount - sCount) <= 3 && pattern.length >= 8;
            });
            
            while (allPatterns.length < 1000) {
                const randomPattern = generateDynamicPatterns()[0];
                if (!allPatterns.includes(randomPattern)) allPatterns.push(randomPattern);
            }
            
            state.stats.aiPatternsGenerated = allPatterns.length;
            state.stats.tenDigitPatterns = allPatterns.filter(p => p.length === 10).length;
            state.stats.nineDigitPatterns = allPatterns.filter(p => p.length === 9).length;
            state.stats.eightDigitPatterns = allPatterns.filter(p => p.length === 8).length;
            state.stats.neuralPatterns = dynamicPatterns.length;
            state.stats.humanPatterns = humanPatterns.length;
            state.stats.quantumPatterns = allPatterns.length - basePatterns.length - transformedPatterns.length - humanPatterns.length;
            
            return allPatterns.slice(0, 1500);
        };

        const predictionPatterns = generateAIHumanDeepPatterns();

        // Sureshot Verification
        const isTrueSureshot = (pattern, currentPattern, matchCount, lastSegmentMatch) => {
            if (matchCount >= 10) {
                const patternStats = state.patternStats[pattern] || { count: 0, wins: 0 };
                if (patternStats.count > 0 && patternStats.wins !== patternStats.count) return false;
                const similarPatterns = predictionPatterns.filter(p => 
                    p !== pattern && 
                    p.startsWith(currentPattern.substring(0, Math.min(7, currentPattern.length))) &&
                    p.endsWith(currentPattern.slice(-Math.min(3, currentPattern.length)))
                );
                return similarPatterns.length <= 2;
            }

            if (matchCount >= 9) {
                const patternStats = state.patternStats[pattern] || { count: 0, wins: 0 };
                if (patternStats.count >= 5 && patternStats.wins / patternStats.count < 0.9) return false;
                return currentPattern.endsWith(pattern.slice(-Math.min(3, pattern.length)));
            }

            return false;
        };

        const isUltraSureshot = (pattern, currentPattern, matchCount) => {
            if (matchCount >= 9.5) {
                const patternStats = state.patternStats[pattern] || { count: 0, wins: 0 };
                if (patternStats.count < 5) return false;
                const winRate = patternStats.wins / patternStats.count;
                return winRate >= ULTRA_SURESHOT_MIN_WIN_RATE && currentPattern.endsWith(pattern.slice(-Math.min(4, pattern.length)));
            }
            return false;
        };

        // Prediction Generation
        const generatePrediction = (results) => {
            if (state.skipNext || state.sureshotCooldown > 0 || state.systemError) {
                if (state.sureshotCooldown > 0) state.sureshotCooldown--;
                return {
                    prediction: 'SKIP',
                    confidence: 'SAFETY',
                    pattern: 'LOSS_PREVENTION',
                    description: 'System is in loss prevention mode or on cooldown.',
                    neuralActivation: 0
                };
            }

            if (results.length < 8) return { // Adjusted for 8-digit patterns
                prediction: 'SKIP',
                confidence: 'SAFETY',
                pattern: 'INSUFFICIENT_DATA',
                description: 'Insufficient data for prediction.',
                neuralActivation: 0
            };

            const lastTen = results.slice(0, 10).map(r => getSize(r.result));
            const currentPattern = lastTen.join('');

            const patternWeights = predictionPatterns.map(pattern => {
                const stats = state.patternStats[pattern] || { count: 0, wins: 0 };
                const winRate = stats.count > 0 ? stats.wins / stats.count : 0.85;
                return { pattern, winRate, count: stats.count };
            });

            const ultraSureshotMatches = [];
            predictionPatterns.forEach(pattern => {
                if (state.patternBlacklist.includes(pattern)) return;
                let matchCount = 0;
                let lastSegmentMatch = true;
                const minLength = Math.min(pattern.length, currentPattern.length);
                for (let i = 0; i < minLength; i++) {
                    if (pattern[i] === currentPattern[i]) matchCount++;
                    else if (i >= pattern.length - 3) lastSegmentMatch = false;
                }
                if (matchCount >= 9.5 && isUltraSureshot(pattern, currentPattern, matchCount)) {
                    const patternStats = state.patternStats[pattern] || { count: 0, wins: 0 };
                    ultraSureshotMatches.push({
                        pattern,
                        matchCount,
                        prediction: pattern[pattern.length-1] === 'B' ? 'BIG' : 'SMALL',
                        winRate: patternStats.count > 0 ? patternStats.wins / patternStats.count : 1,
                        neuralActivation: 0.98 + (patternStats.wins / (patternStats.count + 1)) * 0.02
                    });
                }
            });

            if (ultraSureshotMatches.length > 0) {
                ultraSureshotMatches.sort((a, b) => b.winRate - a.winRate || b.matchCount - a.matchCount);
                const bestMatch = ultraSureshotMatches[0];
                state.stats.ultraSureshotTotal++;
                return {
                    prediction: bestMatch.prediction,
                    confidence: 'ULTRA_SURESHOT',
                    pattern: bestMatch.pattern,
                    description: 'Ultra Sureshot match detected with high confidence.',
                    matchCount: bestMatch.matchCount,
                    isUltraSureshot: true,
                    neuralActivation: bestMatch.neuralActivation
                };
            }

            const perfectMatches = predictionPatterns.filter(pattern => {
                if (pattern.length !== currentPattern.length) return false;
                let matchCount = 0;
                for (let i = 0; i < pattern.length; i++) {
                    if (pattern[i] === currentPattern[i]) matchCount++;
                }
                return matchCount === pattern.length && isTrueSureshot(pattern, currentPattern, matchCount, true);
            });

            if (perfectMatches.length > 0) {
                const bestPattern = perfectMatches[0];
                const nextPred = bestPattern[bestPattern.length-1] === 'B' ? 'BIG' : 'SMALL';
                state.stats.perfectTotal++;
                return {
                    prediction: nextPred,
                    confidence: 'SURESHOT',
                    pattern: bestPattern,
                    description: `Perfect ${bestPattern.length}/${bestPattern.length} pattern match detected.`,
                    matchCount: bestPattern.length,
                    isSureshot: true,
                    isPerfect: true,
                    neuralActivation: 1.0
                };
            }

            const highConfidenceMatches = [];
            predictionPatterns.forEach(pattern => {
                if (state.patternBlacklist.includes(pattern)) return;
                let matchCount = 0;
                let lastSegmentMatch = true;
                const minLength = Math.min(pattern.length, currentPattern.length);
                for (let i = 0; i < minLength; i++) {
                    if (pattern[i] === currentPattern[i]) matchCount++;
                    else if (i >= pattern.length - 3) lastSegmentMatch = false;
                }
                if (matchCount >= Math.min(8, pattern.length) && lastSegmentMatch) {
                    const patternStats = state.patternStats[pattern] || { count: 0, wins: 0 };
                    const winRate = patternStats.count > 0 ? patternStats.wins / patternStats.count : 1;
                    if (winRate >= 0.9 || patternStats.count < 3) {
                        highConfidenceMatches.push({
                            pattern,
                            matchCount,
                            prediction: pattern[pattern.length-1] === 'B' ? 'BIG' : 'SMALL',
                            winRate,
                            neuralActivation: 0.95 + (winRate * 0.05)
                        });
                    }
                }
            });

            if (highConfidenceMatches.length > 0) {
                highConfidenceMatches.sort((a, b) => b.matchCount - a.matchCount || b.winRate - a.winRate);
                const bestMatch = highConfidenceMatches[0];
                state.stats.highConfidenceTotal++;
                return {
                    prediction: bestMatch.prediction,
                    confidence: bestMatch.matchCount >= 9.5 ? 'HIGH' : 'MODERATE',
                    pattern: bestMatch.pattern,
                    description: 'High confidence pattern match detected.',
                    matchCount: bestMatch.matchCount,
                    neuralActivation: bestMatch.neuralActivation,
                    isHighConfidence: true
                };
            }

            const moderateConfidenceMatches = [];
            predictionPatterns.forEach(pattern => {
                if (state.patternBlacklist.includes(pattern)) return;
                let matchCount = 0;
                let lastSegmentMatch = true;
                const minLength = Math.min(pattern.length, currentPattern.length);
                for (let i = 0; i < minLength; i++) {
                    if (pattern[i] === currentPattern[i]) matchCount++;
                    else if (i >= pattern.length - 3) lastSegmentMatch = false;
                }
                if (matchCount >= Math.min(7, pattern.length) && lastSegmentMatch) {
                    const patternStats = state.patternStats[pattern] || { count: 0, wins: 0 };
                    const winRate = patternStats.count > 0 ? patternStats.wins / patternStats.count : 0.85;
                    if (winRate >= 0.85 || patternStats.count < 5) {
                        moderateConfidenceMatches.push({
                            pattern,
                            matchCount,
                            prediction: pattern[pattern.length-1] === 'B' ? 'BIG' : 'SMALL',
                            winRate,
                            neuralActivation: 0.85 + (winRate * 0.15)
                        });
                    }
                }
            });

            if (moderateConfidenceMatches.length > 0) {
                moderateConfidenceMatches.sort((a, b) => b.matchCount - a.matchCount || b.winRate - a.winRate);
                const bestMatch = moderateConfidenceMatches[0];
                state.stats.moderateTotal++;
                return {
                    prediction: bestMatch.prediction,
                    confidence: 'MODERATE',
                    pattern: bestMatch.pattern,
                    description: 'Moderate confidence pattern match detected.',
                    matchCount: bestMatch.matchCount,
                    neuralActivation: bestMatch.neuralActivation
                };
            }

            return {
                prediction: 'SKIP',
                confidence: 'SAFETY',
                pattern: 'NO_MATCH',
                description: 'No reliable pattern match found.',
                isFallback: true
            };
        };

        // Fetch Mock Game Results
        function fetchMockGameResult() {
            const results = [];
            let lastPeriod = state.lastFetchedPeriod ? BigInt(state.lastFetchedPeriod) : BigInt('20240701001');
            let lastResult = Math.random() < 0.5 ? 'B' : 'S';
            for (let i = 0; i < RESULTS_TO_FETCH; i++) {
                const number = lastResult === 'B' ? (Math.random() < 0.7 ? Math.floor(Math.random() * 5) : Math.floor(Math.random() * 5 + 5))
                                           : (Math.random() < 0.7 ? Math.floor(Math.random() * 5 + 5) : Math.floor(Math.random() * 5));
                lastResult = number >= 5 ? 'B' : 'S';
                results.push({
                    issueNumber: (lastPeriod + BigInt(i)).toString(),
                    number: number.toString(),
                    openTime: new Date(Date.now() - i * 60000).toLocaleString()
                });
            }
            state.lastFetchedPeriod = results[0].issueNumber;
            console.log("Using mock data for game results.");
            return results;
        }

        // Fetch Game Results from API
        async function fetchGameResult(maxRetries = 3, retryDelay = 2000) {
            state.isLoading = true;
            render();
            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                try {
                    const timestamp = Date.now();
                    const response = await fetch(`https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?ts=${timestamp}`);
                    const data = await response.json();
                    if (!data?.data?.list || !Array.isArray(data.data.list) || data.data.list.length === 0) {
                        console.warn(`Attempt ${attempt}: API returned no valid data.`);
                        if (attempt === maxRetries) {
                            state.isLive = false;
                            state.isLoading = false;
                            renderErrorNotification();
                            return fetchMockGameResult();
                        }
                        await new Promise(resolve => setTimeout(resolve, retryDelay));
                        continue;
                    }
                    state.isLive = true;
                    state.isLoading = false;
                    return data.data.list.map(item => ({
                        issueNumber: item.issueNumber,
                        number: item.number
                    }));
                } catch (e) {
                    console.error(`Attempt ${attempt}: API error:`, e);
                    if (attempt === maxRetries) {
                        state.isLive = false;
                        state.isLoading = false;
                        renderErrorNotification();
                        return fetchMockGameResult();
                    }
                    await new Promise(resolve => setTimeout(resolve, retryDelay));
                }
            }
        }

        // Render Error Notification
        function renderErrorNotification() {
            const appRoot = document.getElementById('app-root');
            appRoot.insertAdjacentHTML('afterbegin', `
                <div class="glass-card p-4 mb-4 bg-gradient-to-br from-red-900 to-orange-900">
                    <div class="flex items-center">
                        <i data-lucide="alert-circle" class="text-yellow-400 w-5 h-5 mr-2"></i>
                        <span class="text-sm">Failed to fetch data. Using mock results.</span>
                    </div>
                </div>
            `);
            lucide.createIcons();
        }

        // Check Win Streak
        const checkWinStreak = (history) => {
            const recentResolved = history.filter(h => h.status !== 'PENDING' && h.status !== 'SKIPPED').slice(0, STREAK_THRESHOLD);
            if (recentResolved.length < STREAK_THRESHOLD) return null;
            const firstPrediction = recentResolved[0].prediction;
            const firstPattern = recentResolved[0].pattern;
            if (recentResolved.every(p => p.status === 'WIN' && p.prediction === firstPrediction && p.pattern === firstPattern)) {
                return {
                    prediction: firstPrediction,
                    pattern: firstPattern,
                    count: recentResolved.length
                };
            }
            return null;
        };

        // Update Prediction
        const updatePrediction = async () => {
            const apiResults = await fetchGameResult();
            if (!apiResults || apiResults.length === 0) return;

            const latestResult = apiResults[0];
            if (latestResult.issueNumber === state.lastFetchedPeriod) return;

            state.lastFetchedPeriod = latestResult.issueNumber;
            const newPeriod = (BigInt(latestResult.issueNumber) + 1n).toString();
            state.recentResults = apiResults.slice(0, RESULTS_TO_FETCH).map(item => ({
                period: item.issueNumber,
                result: parseInt(item.number, 10)
            }));

            let updatedHistory = state.history.map(item => {
                if (item.status === 'PENDING') {
                    const result = state.recentResults.find(r => r.period === item.period);
                    if (result) {
                        let isWin = false;
                        if (item.isUltraSureshot) {
                            isWin = (item.prediction === 'BIG' && result.result >= 5) ||
                                   (item.prediction === 'SMALL' && result.result < 5);
                            if (isWin) state.stats.ultraSureshotWins++;
                            else {
                                console.error("CRITICAL: Ultra Sureshot prediction failed!", item);
                                state.systemError = true;
                                state.skipNext = true;
                                state.sureshotCooldown = 5;
                                return { ...item, status: 'LOSS', result: result.result };
                            }
                        } else if (item.isPerfect) {
                            if ((item.prediction === 'BIG' && result.result >= 5) ||
                                (item.prediction === 'SMALL' && result.result < 5)) {
                                isWin = true;
                                state.stats.perfectWins++;
                            } else {
                                console.error("CRITICAL: Perfect prediction failed!", item);
                                state.systemError = true;
                                state.skipNext = true;
                                return { ...item, status: 'LOSS', result: result.result };
                            }
                        } else if (item.isHighConfidence) {
                            isWin = (item.prediction === 'BIG' && result.result >= 5) ||
                                   (item.prediction === 'SMALL' && result.result < 5);
                            if (isWin) state.stats.highConfidenceWins++;
                            else state.patternBlacklist.push(item.pattern);
                        } else if (item.confidence === 'MODERATE') {
                            isWin = (item.prediction === 'BIG' && result.result >= 5) ||
                                   (item.prediction === 'SMALL' && result.result < 5);
                            if (isWin) state.stats.moderateWins++;
                        } else {
                            isWin = (item.prediction === 'BIG' && result.result >= 5) ||
                                   (item.prediction === 'SMALL' && result.result < 5);
                        }

                        if (isWin) {
                            state.stats.totalWins++;
                            if (item.confidence === 'SURESHOT' || item.confidence === 'ULTRA_SURESHOT') {
                                state.stats.sureshotWins++;
                                state.stats.consecutiveSureshotWins++;
                                state.stats.consecutiveSureshotLosses = 0;
                            }
                        } else if (item.prediction !== 'SKIP') {
                            state.stats.totalLosses++;
                            if (item.confidence === 'SURESHOT' || item.confidence === 'ULTRA_SURESHOT') {
                                state.stats.consecutiveSureshotLosses++;
                                state.stats.consecutiveSureshotWins = 0;
                            }
                        } else {
                            state.stats.skipped++;
                        }

                        const total = state.stats.totalWins + state.stats.totalLosses;
                        state.stats.winRate = total > 0 ? Math.round((state.stats.totalWins / total) * 100) : 0;

                        if (item.pattern) {
                            state.patternStats[item.pattern] = state.patternStats[item.pattern] || { count: 0, wins: 0 };
                            state.patternStats[item.pattern].count++;
                            if (isWin) state.patternStats[item.pattern].wins++;
                        }

                        if (!isWin && item.prediction !== 'SKIP') {
                            state.lastLossPeriod = item.period;
                            state.consecutiveLosses++;
                            if (state.consecutiveLosses >= MAX_CONSECUTIVE_LOSSES) {
                                state.skipNext = true;
                                state.sureshotCooldown = 3;
                            }
                        } else if (isWin) {
                            state.consecutiveLosses = 0;
                        }

                        if (item.isStreak && !isWin) state.currentStreak = null;
                        return { ...item, status: isWin ? 'WIN' : item.prediction === 'SKIP' ? 'SKIPPED' : 'LOSS', result: result.result };
                    }
                }
                return item;
            });

            const predictionData = generatePrediction(state.recentResults);
            const newPrediction = {
                id: `${newPeriod}-${Date.now()}`,
                period: newPeriod,
                prediction: predictionData.prediction,
                confidence: predictionData.confidence,
                pattern: predictionData.pattern,
                patternDescription: predictionData.description,
                status: 'PENDING',
                timestamp: Date.now(),
                isUltraSureshot: predictionData.isUltraSureshot || false,
                isPerfect: predictionData.isPerfect || false,
                isHighConfidence: predictionData.isHighConfidence || false,
                matchCount: predictionData.matchCount || 0,
                neuralActivation: predictionData.neuralActivation || 0,
                isFallback: predictionData.isFallback || false
            };

            state.currentPrediction = newPrediction;
            state.currentPeriod = newPeriod;
            state.history = [newPrediction, ...updatedHistory].slice(0, MAX_HISTORY_ITEMS);
            saveState();
            render();
        };

        // Debounce API Calls
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        const debouncedUpdatePrediction = debounce(updatePrediction, 1000);

        // Update Time
        const updateTime = () => {
            state.currentTime = new Date().toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' });
            const timeElement = document.getElementById('ist-time');
            if (timeElement) timeElement.textContent = state.currentTime;
        };

        // UI Components
        const PredictionIcon = (prediction) => {
            const icons = {
                BIG: `<i data-lucide="arrow-up" class="w-5 h-5 text-blue-400"></i>`,
                SMALL: `<i data-lucide="arrow-down" class="w-5 h-5 text-purple-400"></i>`,
                SKIP: `<i data-lucide="skip-forward" class="w-5 h-5 text-gray-400"></i>`
            };
            return icons[prediction] || `<i data-lucide="help-circle" class="w-5 h-5 text-gray-400"></i>`;
        };

const StatusIcon = (status) => {
            const icons = {
                WIN: `<svg class="w-5 h-5 text-green-400 win-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5" />
                      </svg>`,
                LOSS: `<svg class="w-5 h-5 text-red-400 loss-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                         <path d="M18 6L6 18M6 6l12 12" />
                       </svg>`,
PENDING: `<i class="fas fa-circle-notch fa-spin text-yellow-400 text-sm"></i>`,
                SKIPPED: `<i data-lucide="skip-forward" class="w-5 h-5 text-gray-400"></i>`
            };
            return icons[status] || `<i data-lucide="help-circle" class="w-5 h-5 text-gray-400"></i>`;
        };

        const ConfidenceIndicator = (confidence) => {
            const styles = {
                ULTRA_SURESHOT: { icon: 'crown', color: 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' },
                SURESHOT: { icon: 'zap', color: 'bg-gradient-to-r from-green-500 to-emerald-500 text-white' },
                HIGH: { icon: 'activity', color: 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white' },
                MODERATE: { icon: 'alert-circle', color: 'bg-gradient-to-r from-yellow-500 to-amber-500 text-black' },
                STREAK: { icon: 'trending-up', color: 'bg-gradient-to-r from-purple-500 to-pink-500 text-white' },
                INTUITION: { icon: 'brain', color: 'bg-gradient-to-r from-pink-500 to-rose-500 text-white' },
                SAFETY: { icon: 'shield', color: 'bg-gradient-to-r from-gray-500 to-gray-700 text-white' }
            };
            const style = styles[confidence] || { icon: 'help-circle', color: 'bg-gray-500 text-white' };
            return `<span class="text-xs px-3 py-1.5 rounded-full font-bold ${style.color} flex items-center">
                        <i data-lucide="${style.icon}" class="w-3 h-3 mr-1"></i>
                    </span>`;
        };

        const getStats = () => {
            const totalWins = state.stats.totalWins;
            const totalLosses = state.stats.totalLosses;
            const skipped = state.stats.skipped;
            const winRate = totalWins + totalLosses > 0 ? Math.round((totalWins / (totalWins + totalLosses)) * 100) : 0;
            const ultraSureshotRate = state.stats.ultraSureshotTotal > 0 ? Math.round((state.stats.ultraSureshotWins / state.stats.ultraSureshotTotal) * 100) : 100;
            const perfectRate = state.stats.perfectTotal > 0 ? Math.round((state.stats.perfectWins / state.stats.perfectTotal) * 100) : 100;
            const highConfidenceRate = state.stats.highConfidenceTotal > 0 ? Math.round((state.stats.highConfidenceWins / state.stats.highConfidenceTotal) * 100) : 100;
            const moderateRate = state.stats.moderateTotal > 0 ? Math.round((state.stats.moderateWins / state.stats.moderateTotal) * 100) : 0;

            return { 
                totalWins, totalLosses, skipped, winRate, 
                ultraSureshotWins: state.stats.ultraSureshotWins,
                ultraSureshotTotal: state.stats.ultraSureshotTotal,
                ultraSureshotRate,
                perfectWins: state.stats.perfectWins,
                perfectTotal: state.stats.perfectTotal, 
                perfectRate, 
                highConfidenceWins: state.stats.highConfidenceWins,
                highConfidenceTotal: state.stats.highConfidenceTotal, 
                highConfidenceRate,
                moderateWins: state.stats.moderateWins, 
                moderateTotal: state.stats.moderateTotal, 
                moderateRate,
                nineTenLosses: state.stats.nineTenLosses, 
                sureshotWins: state.stats.sureshotWins,
                sureshotTotal: state.stats.sureshotTotal,
                sureshotRate: state.stats.sureshotTotal > 0 ? Math.round((state.stats.sureshotWins / state.stats.sureshotTotal) * 100) : 100,
                consecutiveSureshotWins: state.stats.consecutiveSureshotWins,
                consecutiveSureshotLosses: state.stats.consecutiveSureshotLosses,
                aiPatterns: state.stats.aiPatternsGenerated, 
                nineDigitPatterns: state.stats.nineDigitPatterns,
                eightDigitPatterns: state.stats.eightDigitPatterns,
                tenDigitPatterns: state.stats.tenDigitPatterns,
                humanPatterns: state.stats.humanPatterns
            };
        };

        const HomePage = () => {
            const stats = getStats();
            return `
                <div class="pt-8">
                    <div class="flex flex-col items-center mb-12">
                        <h1 class="text-3xl font-bold orbitron text-center">RIO PTN V2</h1>
                        <div class="relative mt-4">
                            <div class="relative bg-gradient-to-r from-purple-600 to-pink-600 p-1 rounded-full">
                                <div class="bg-gray-900 rounded-full p-4">
                                    <i data-lucide="brain" class="text-blue-400 w-12 h-12 neural-pulse"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${state.systemError ? `
                        <div class="glass-card p-5 mb-6 bg-gradient-to-br from-red-900 to-orange-900">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="alert-triangle" class="text-yellow-400 w-6 h-6 mr-3"></i>
                                    <span class="text-sm">System Error: Critical prediction failure detected</span>
                                </div>
                                <button onclick="resetSystemError()" class="px-3 py-1 bg-gradient-to-r from-green-600 to-emerald-600 rounded-full text-sm font-bold">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i> Reset
                                </button>
                            </div>
                        </div>
                    ` : ''}

                    <div class="glass-card p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-bold">System Status</h2>
                            ${state.isLoading ? `
                                <div class="flex items-center">
                                    <i data-lucide="loader-2" class="w-5 h-5 text-blue-400 loading-spinner mr-2"></i>
                                    <span>Loading...</span>
                                </div>
                            ` : `
                                <div class="flex items-center">
                                    <i data-lucide="${state.isLive ? 'radio' : 'x-circle'}" class="w-5 h-5 ${state.isLive ? 'text-green-400' : 'text-red-400'}"></i>
                                    <span class="ml-2">${state.isLive ? 'Live' : 'Offline'}</span>
                                </div>
                            `}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="glass-card p-4 rounded-xl">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-green-600 to-emerald-700 rounded-lg mr-3">
                                        ${StatusIcon('WIN')}
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-green-400">${stats.winRate}%</p>
                                        <p class="text-sm text-gray-400">Win Rate</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl ultra-sureshot-glow">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-pink-600 to-rose-700 rounded-lg mr-3">
                                        <i data-lucide="crown" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-pink-400">${stats.ultraSureshotRate}%</p>
                                        <p class="text-sm text-gray-400">Ultra Sureshot Rate</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl perfect-glow">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-emerald-600 to-green-700 rounded-lg mr-3">
                                        <i data-lucide="award" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-emerald-400">${stats.perfectRate}%</p>
                                        <p class="text-sm text-gray-400">Perfect Rate</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg mr-3">
                                        <i data-lucide="star" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-blue-400">${stats.highConfidenceRate}%</p>
                                        <p class="text-sm text-gray-400">High Confidence Rate</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-amber-600 to-orange-700 rounded-lg mr-3">
                                        <i data-lucide="shield" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-amber-400">${state.skipNext ? '<i data-lucide="lock" class="w-5 h-5"></i>' : '<i data-lucide="unlock" class="w-5 h-5"></i>'}</p>
                                        <p class="text-sm text-gray-400">Safety Mode</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl neuron">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-purple-600 to-pink-700 rounded-lg mr-3">
                                        <i data-lucide="cpu" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-purple-400">${stats.aiPatterns}+</p>
                                        <p class="text-sm text-gray-400">Total Patterns</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-indigo-600 to-blue-700 rounded-lg mr-3">
                                        <i data-lucide="hash" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-indigo-400">${stats.tenDigitPatterns}</p>
                                        <p class="text-sm text-gray-400">10-Digit Patterns</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-teal-600 to-cyan-700 rounded-lg mr-3">
                                        <i data-lucide="hash" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-teal-400">${stats.nineDigitPatterns}</p>
                                        <p class="text-sm text-gray-400">9-Digit Patterns</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-xl">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-violet-600 to-purple-700 rounded-lg mr-3">
                                        <i data-lucide="hash" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-violet-400">${stats.eightDigitPatterns}</p>
                                        <p class="text-sm text-gray-400">8-Digit Patterns</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card p-5 mb-8">
                        <h2 class="text-lg font-bold mb-4">All Patterns</h2>
                        <div class="patterns-container">
                            ${predictionPatterns.length === 0 ? `
                                <div class="text-center p-12">
                                    <i data-lucide="database" class="mx-auto text-gray-500 w-12 h-12 mb-4"></i>
                                    <p class="text-gray-400">No patterns available</p>
                                </div>
                            ` : `
                                <div class="grid grid-cols-2 gap-2">
                                    ${predictionPatterns.map((pattern, index) => `
                                        <div class="pattern-display text-sm font-mono bg-gray-800/50 p-2 rounded">
                                            <span class="text-gray-400 mr-2">${index + 1}.</span>
                                            ${pattern.split('').map((char, i) => 
                                                `<span class="${i === pattern.length-1 ? 'text-yellow-400 font-bold' : char === 'B' ? 'text-blue-400' : 'text-purple-400'}">${char}</span>`
                                            ).join('')}
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                    
                    <button onclick="setActiveTab('dashboard')" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-bold text-lg flex items-center justify-center">
                        <i data-lucide="zap" class="mr-2"></i> Go to Dashboard
                    </button>
                </div>
            `;
        };

        const DashboardPage = () => {
          const stats = getStats();
            const pred = state.currentPrediction;
            const predBg = pred?.prediction === 'BIG' ? 'bg-gradient-to-br from-blue-900 to-blue-800' : 
                          pred?.prediction === 'SMALL' ? 'bg-gradient-to-br from-purple-900 to-purple-800' : 
                          'bg-gradient-to-br from-gray-900 to-gray-800';
            
            return `
                <div class="pt-6">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h1 class="text-xl font-bold">RIO PTN V2</h1>
                            <div id="ist-time" class="text-sm text-gray-400 mt-1">${state.currentTime}</div>
                        </div>
                        <div class="flex items-center px-3 py-1.5 ${state.isLoading ? 'bg-gradient-to-r from-blue-700 to-blue-800' : state.isLive ? 'bg-gradient-to-r from-green-700 to-emerald-800' : 'bg-gradient-to-r from-red-700 to-orange-800'} rounded-full">
                            ${state.isLoading ? `
                                <i data-lucide="loader-2" class="w-4 h-4 text-blue-400 loading-spinner"></i>
                            ` : `
                                <i data-lucide="${state.isLive ? 'radio' : 'x-circle'}" class="w-4 h-4 ${state.isLive ? 'text-green-400' : 'text-red-400'}"></i>
                            `}
                        </div>
                    </div>
                    
                    ${state.systemError ? `
                        <div class="glass-card p-5 mb-6 bg-gradient-to-br from-red-900 to-orange-900">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i data-lucide="alert-triangle" class="text-yellow-400 w-6 h-6 mr-3"></i>
                                    <span class="text-sm">System Error: Critical prediction failure detected</span>
                                </div>
                                <button onclick="resetSystemError()" class="px-3 py-1 bg-gradient-to-r from-green-600 to-emerald-600 rounded-full text-sm font-bold">
                                    <i data-lucide="refresh-cw" class="w-4 h-4 mr-1"></i> Reset
                                </button>
                            </div>
                        </div>
                    ` : ''}

                    <div class="glass-card p-5 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-bold">Current Period</h2>
                            <span class="px-2 py-1 bg-gray-800 rounded text-sm">${state.currentPeriod ? `#${state.currentPeriod.slice(-4)}` : '----'}</span>
                        </div>
                        <p class="font-mono text-3xl font-bold text-center orbitron py-3">${state.currentPeriod || ''}</p>
                    </div>
                    
                    <div class="glass-card overflow-hidden mb-6 ${pred?.isUltraSureshot ? 'ultra-sureshot-glow' : pred?.isPerfect ? 'perfect-glow' : pred?.isHighConfidence ? 'sureshot-glow' : ''}">
                        <div class="${predBg} p-5">
                            <div class="flex justify-between items-center mb-3">
                                <h2 class="text-lg font-bold">Prediction</h2>
                                ${pred ? ConfidenceIndicator(pred.confidence) : ''}
                            </div>
                            
                            <div class="text-center py-4">
                                <div class="flex justify-center items-center text-5xl font-bold mb-2 orbitron">
                                    ${pred ? PredictionIcon(pred.prediction) : ''} ${pred?.prediction === 'BIG' || pred?.prediction === 'SMALL' ? pred.prediction : ''}
                                </div>
                                ${pred?.matchCount ? `<div class="text-gray-400 text-sm">${Math.round(pred.matchCount*10)/10}/${pred.pattern.length}</div>` : ''}
                                ${pred?.isUltraSureshot ? `
                                    <div class="mt-2 text-xs bg-pink-900/50 text-pink-300 rounded-full px-2 py-1 inline-block flex items-center">
                                        <i data-lucide="crown" class="w-3 h-3 mr-1"></i>
                                    </div>
                                ` : pred?.isPerfect ? `
                                    <div class="mt-2 text-xs bg-emerald-900/50 text-emerald-300 rounded-full px-2 py-1 inline-block flex items-center">
                                        <i data-lucide="award" class="w-3 h-3 mr-1"></i>
                                    </div>
                                ` : pred?.isHighConfidence ? `
                                    <div class="mt-2 text-xs bg-blue-900/50 text-blue-300 rounded-full px-2 py-1 inline-block flex items-center">
                                        <i data-lucide="star" class="w-3 h-3 mr-1"></i>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${pred?.isUltraSureshot ? `
                                <div class="mt-4 p-3 bg-gradient-to-r from-pink-800 to-rose-900 rounded-lg flex items-center">
                                    <i data-lucide="crown" class="text-pink-400 mr-2"></i>
                                    <span class="text-sm">${pred.patternDescription}</span>
                                </div>
                            ` : pred?.isPerfect ? `
                                <div class="mt-4 p-3 bg-gradient-to-r from-emerald-800 to-green-900 rounded-lg flex items-center">
                                    <i data-lucide="award" class="text-yellow-400 mr-2"></i>
                                    <span class="text-sm">${pred.patternDescription}</span>
                                </div>
                            ` : pred?.isHighConfidence ? `
                                <div class="mt-2 p-3 bg-gradient-to-r from-blue-800 to-indigo-900 rounded-lg flex items-center">
                                    <i data-lucide="star" class="text-yellow-400 mr-2"></i>
                                    <span class="text-sm">${pred.patternDescription}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="p-4">
                            <h2 class="text-lg font-bold mb-3">Recent Results</h2>
                            <div class="flex space-x-2 overflow-x-auto pb-2">
                                ${state.recentResults.length > 0 ? state.recentResults.slice(0, 10).map(r => `
                                    <div class="flex flex-col items-center min-w-[60px] flip-in">
                                        <div class="text-xs text-gray-500 mb-1">#${r.period.slice(-4)}</div>
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${r.result >= 5 ? 'bg-gradient-to-br from-blue-600 to-blue-800 text-white' : 'bg-gradient-to-br from-purple-600 to-purple-800 text-white'}">
                                            ${r.result}
                                        </div>
                                    </div>
                                `).join('') : '<i data-lucide="loader-2" class="text-gray-400 w-5 h-5 loading-spinner"></i>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card p-5">
                        <h2 class="text-lg font-bold mb-4">Statistics</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="glass-card p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-green-600 to-emerald-700 rounded-lg mr-3">
                                        ${StatusIcon('WIN')}
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-green-400">${stats.totalWins}</p>
                                        <p class="text-sm text-gray-400">Total Wins</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-br from-red-600 to-orange-700 rounded-lg mr-3">
                                        ${StatusIcon('LOSS')}
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-red-400">${stats.totalLosses}</p>
                                        <p class="text-sm text-gray-400">Total Losses</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-lg ultra-sureshot-glow">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-r from-pink-600 to-rose-700 rounded-lg mr-3">
                                        <i data-lucide="crown" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-pink-400">${stats.ultraSureshotWins}/${stats.ultraSureshotTotal}</p>
                                        <p class="text-sm text-gray-400">Ultra Sureshot</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-lg perfect-glow">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-r from-emerald-600 to-green-700 rounded-lg mr-3">
                                        <i data-lucide="award" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-emerald-400">${stats.perfectWins}/${stats.perfectTotal}</p>
                                        <p class="text-sm text-gray-400">Perfect Predictions</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-r from-blue-600 to-indigo-700 rounded-lg mr-3">
                                        <i data-lucide="star" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-blue-400">${stats.highConfidenceWins}/${stats.highConfidenceTotal}</p>
                                        <p class="text-sm text-gray-400">High Confidence</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-card p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-2 bg-gradient-to-r from-yellow-600 to-amber-700 rounded-lg mr-3">
                                        <i data-lucide="alert-circle" class="text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-xl font-bold text-yellow-400">${stats.moderateWins}/${stats.moderateTotal}</p>
                                        <p class="text-sm text-gray-400">Moderate Confidence</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        const HistoryPage = () => {
            const stats = getStats();
            return `
                <div class="pt-6">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h1 class="text-xl font-bold">Prediction History</h1>
                            <div class="text-sm text-gray-400">${state.history.length} Records</div>
                        </div>
                        <button onclick="state.showPatterns = !state.showPatterns; render()" class="flex items-center px-3 py-1.5 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full text-xs font-bold">
                            ${state.showPatterns ? '<i data-lucide="eye-off" class="w-4 h-4 mr-1"></i> Hide Patterns' : '<i data-lucide="eye" class="w-4 h-4 mr-1"></i> Show Patterns'}
                        </button>
                    </div>
                    
                    <div class="history-container">
                        ${state.history.length === 0 ? `
                            <div class="glass-card p-12 text-center">
                                <i data-lucide="database" class="mx-auto text-gray-500 w-12 h-12 mb-4"></i>
                                <p class="text-gray-400">No history available</p>
                            </div>
                        ` : `
                            <div class="space-y-3">
                                ${state.history.slice().reverse().map(item => {
                                    const statusStyles = {
                                        WIN: 'border-green-500/30',
                                        LOSS: 'border-red-500/30',
                                        PENDING: 'border-yellow-500/30',
                                        SKIPPED: 'border-gray-500/30'
                                    }[item.status] || 'border-gray-500/30';
                                    
                                    return `
                                    <div class="glass-card p-4 rounded-xl border ${statusStyles} relative
                                        ${item.isUltraSureshot ? 'ultra-sureshot ultra-sureshot-glow' : item.isPerfect ? 'perfect-prediction perfect-glow' : item.isHighConfidence ? 'high-confidence sureshot-glow' : ''}">
                                        
                                        ${item.isUltraSureshot ? `
                                            <div class="absolute top-2 right-2">
                                                <span class="px-2 py-1 rounded-full text-xs font-bold bg-pink-900/80 text-pink-300 flex items-center">
                                                    <i data-lucide="crown" class="w-3 h-3 mr-1"></i>
                                                </span>
                                            </div>
                                        ` : item.isPerfect ? `
                                            <div class="absolute top-2 right-2">
                                                <span class="px-2 py-1 rounded-full text-xs font-bold bg-emerald-900/80 text-emerald-300 flex items-center">
                                                    <i data-lucide="award" class="w-3 h-3 mr-1"></i>
                                                </span>
                                            </div>
                                        ` : item.isHighConfidence ? `
                                            <div class="absolute top-2 right-2">
                                                <span class="px-2 py-1 rounded-full text-xs font-bold bg-blue-900/80 text-blue-300 flex items-center">
                                                    <i data-lucide="star" class="w-3 h-3 mr-1"></i>
                                                </span>
                                            </div>
                                        ` : ''}
                                        
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="flex items-center mb-2">
                                                    <span class="font-mono font-bold text-gray-300">${item.period}</span>
                                                    <span class="ml-3 px-2 py-1 rounded-full text-xs font-bold bg-gray-800">${PredictionIcon(item.prediction)}</span>
                                                </div>
                                                
                                                <div class="flex items-center flex-wrap gap-2 mt-2">
                                                    ${StatusIcon(item.status)}
                                                    ${ConfidenceIndicator(item.confidence)}
                                                    ${item.matchCount ? `<span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-800">${Math.round(item.matchCount*10)/10}/${item.pattern.length}</span>` : ''}
                                                </div>
                                                
                                                ${state.showPatterns && item.pattern ? `
                                                    <div class="mt-3 pt-3 border-t border-gray-700/30">
                                                        <div class="text-xs text-gray-400 mb-1">Pattern</div>
                                                        <div class="pattern-display text-sm font-mono bg-gray-800/50 p-2 rounded">
                                                            ${item.pattern.split('').map((char, i) => 
                                                                `<span class="${i === item.pattern.length-1 ? 'text-yellow-400 font-bold' : char === 'B' ? 'text-blue-400' : 'text-purple-400'}">${char}</span>`
                                                            ).join('')}
                                                        </div>
                                                    </div>
                                                ` : ''}
                                            </div>
                                            
                                            <div class="text-right">
                                                ${item.result !== undefined ? `
                                                    <p class="text-sm font-semibold">${item.result >= 5 ? PredictionIcon('BIG') : PredictionIcon('SMALL')}</p>
                                                    <p class="text-xs text-gray-400">${item.result}</p>
                                                ` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        };
        


const SettingsPage = () => {
    return `
        <div class="pt-6 px-2">
<h1 class="text-2xl font-bold mb-6 text-center flex items-center justify-center gap-2">
  <i class="fas fa-cogs text-purple-400"></i> Settings
</h1>
                <div class="space-y-4">
                <button onclick="openAboutPopup()" class="w-full flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-purple-700 to-violet-800 shadow-md hover:scale-[1.02] transition">
                    <i class="fas fa-info-circle text-white text-lg"></i>
                    <div>
                        <p class="font-semibold">About RIO PTN V2</p>
                        <p class="text-xs text-gray-300">Learn about this AI system</p>
                    </div>
                </button>

                <button onclick="openVideoPopup()" class="w-full flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-blue-700 to-indigo-800 shadow-md hover:scale-[1.02] transition">
                    <i class="fas fa-play-circle text-white text-lg"></i>
                    <div>
                        <p class="font-semibold">All Tutorial in insta</p>
                        <p class="text-xs text-gray-300">See how it works</p>
                    </div>
                </button>

                <a href="https://whatsapp.com/channel/0029Vb6ZilVBvvslAdqnnr3r" target="_blank" class="block w-full">
                    <div class="flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-teal-600 to-cyan-700 shadow-md hover:scale-[1.02] transition">
                        <i class="fab fa-telegram-plane text-white text-lg"></i>
                        <div>
                            <p class="font-semibold">Join whatsapp</p>
                            <p class="text-xs text-gray-300">Get updates and support</p>
                        </div>
                    </div>
                </a>

<a href="https://wa.me/qr/TKIDHQC4KXIBO1" target="_blank" class="block w-full">
  <div class="flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-pink-600 to-rose-700 shadow-md hover:scale-[1.02] transition">
      <i class="fab fa-telegram-plane text-white text-lg"></i>
      <div>
          <p class="font-semibold">Contact Owner</p>
          <p class="text-xs text-gray-300">Message us on WhatsApp</p>
      </div>
  </div>
</a>

            </div>
        </div>
    `;
};


        const PremiumNavigation = () => {
            const navItems = [
    { tab: 'home', icon: 'home', label: 'Home' },
    { tab: 'dashboard', icon: 'bar-chart-2', label: 'Dashboard' },
    { tab: 'history', icon: 'clock', label: 'History' },
    { tab: 'settings', icon: 'settings', label: 'Settings' }
];

            return `
                <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto">
                    <div class="glass-card backdrop-blur-lg border-t border-gray-700/30 m-4 rounded-2xl shadow-lg">
                        <div class="flex justify-around items-center h-16">
                        ${navItems.map(({ tab, icon, label }) => `
                            <button onclick="setActiveTab('${tab}')" class="flex flex-col items-center justify-center p-2 rounded-full transition-colors w-20 ${state.activeTab === tab ? 'text-purple-400' : 'text-gray-500 hover:text-purple-400'}">
                                <i data-lucide="${icon}" size="24"></i>
                                <span class="text-xs mt-1">${label}</span>
                            </button>
                        `).join('')}
                        </div>
                    </div>
                </div>
            `;
        };

        // Event Handlers
        const setActiveTab = (tab) => {
            state.activeTab = tab;
            render();
        };

        const resetSystemError = () => {
            state.systemError = false;
            state.skipNext = false;
            state.sureshotCooldown = 0;
            render();
        };

        // Main Render Function
        function render() {
            const appRoot = document.getElementById('app-root');
            const navRoot = document.getElementById('navigation-root');
            const pages = { home: HomePage, dashboard: DashboardPage, history: HistoryPage, settings: SettingsPage };
            appRoot.innerHTML = pages[state.activeTab] ? pages[state.activeTab]() : '';
            navRoot.innerHTML = PremiumNavigation();
            lucide.createIcons();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log("AI+HUMAN BRAIN ULTRA ADVANCED PREDICTION SYSTEM Initializing...");
            render();
            updateTime();
            setInterval(updateTime, 1000);
            debouncedUpdatePrediction();
            setInterval(debouncedUpdatePrediction, POLLING_INTERVAL);
        });
        
function openAboutPopup() {
    document.getElementById('aboutModal').classList.remove('hidden');
}

function openVideoPopup() {
    document.getElementById('videoModal').classList.remove('hidden');
}

function closePopup(id) {
    document.getElementById(id).classList.add('hidden');
}


        // Global Functions
        window.setActiveTab = setActiveTab;
        window.resetSystemError = resetSystemError;
    </script>
</body>
</html>